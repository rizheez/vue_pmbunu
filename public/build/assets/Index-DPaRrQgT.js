import{_ as w}from"./index-Bnj2O5SM.js";import{_ as U,a as j,b as B,c as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-OGboqqG0.js";import{_ as F}from"./CardDescription.vue_vue_type_script_setup_true_lang-BTpUeXs5.js";import{_ as C}from"./Checkbox.vue_vue_type_script_setup_true_lang-Dd83jkrM.js";import{_ as A,a as E,b as H,c as R}from"./DialogTitle.vue_vue_type_script_setup_true_lang-C_BTeRTX.js";import{_ as J}from"./DialogDescription.vue_vue_type_script_setup_true_lang-fMlgHnTl.js";import{_ as O}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CWucB8A7.js";import{_ as Q}from"./Input.vue_vue_type_script_setup_true_lang-yRAh9zpW.js";import{_ as q,a as K,b as W,c as X,d as M}from"./SelectValue.vue_vue_type_script_setup_true_lang-BG14-buR.js";import{b as Y,_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-D-6hMirW.js";import{d as ee,p as _,A as te,s as N,c as ae,a as r,e as l,u as s,h as se,w as o,b as e,f,k,o as i,t as n,i as $,F as p,r as x,n as le,C as ne}from"./app-CixX7tqV.js";import{G as oe}from"./user-plus-CNYCX9W9.js";import{L as ie}from"./loader-circle-0WcKEJut.js";import{S as re}from"./search-DZiGq_5Q.js";import"./useForwardPropsEmits-CiC4MhO_.js";import"./VisuallyHidden-BOc2leka.js";import"./createLucideIcon-CCwgtwWF.js";import"./index-CtHZGfNm.js";import"./useFormControl-DFfQXRHB.js";import"./useForwardExpose-Cqag_0aS.js";import"./check-DNmQRUp-.js";import"./ChatWidget.vue_vue_type_script_setup_true_lang-5urO2WRG.js";import"./index-CMWG4mbA.js";import"./chevron-down-DUiVqJmU.js";import"./triangle-alert-CelnzRQs.js";import"./circle-x-DlQYkttV.js";import"./file-text-DhU1w16m.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"flex flex-col gap-6 p-4"},ue={class:"flex items-center justify-between"},me={class:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center"},ce={class:"relative flex-1"},fe={class:"overflow-x-auto rounded-lg border"},_e={class:"w-full text-sm"},pe={class:"bg-muted/50"},ve={class:"w-12 px-4 py-3"},ge={class:"divide-y"},xe={class:"px-4 py-3"},he={class:"px-4 py-3 font-mono text-xs text-muted-foreground"},ye={class:"px-4 py-3"},be={class:"font-medium"},ke={class:"text-xs text-muted-foreground"},$e={class:"px-4 py-3"},we={key:0,class:"flex items-center gap-2"},Ne={class:"rounded bg-muted px-1.5 py-0.5 text-xs font-mono"},Se={key:1,class:"text-muted-foreground"},Ve={class:"px-4 py-3"},Ce={class:"px-4 py-3"},Me={class:"px-4 py-3 text-muted-foreground"},Te={key:0},Ge={key:0,class:"mt-4 flex items-center justify-between"},Ie={class:"text-sm text-muted-foreground"},De={class:"flex gap-2"},ze={class:"max-h-80 space-y-4 overflow-y-auto"},Le={key:0},Ue={class:"mb-2 font-medium text-green-600"},je={class:"space-y-1"},Be={class:"font-mono font-medium"},Pe={key:1},Fe={class:"mb-2 font-medium text-red-600"},Ae={class:"space-y-1"},Ee={class:"font-medium"},He={class:"text-xs text-red-600"},xt=ee({__name:"Index",props:{registrations:{},programStudi:{},filters:{}},setup(c){const v=c,T=[{title:"Dashboard",href:"/admin/dashboard"},{title:"Generate NIM",href:"/admin/nim-generation"}],h=_(v.filters.search),g=_(v.filters.prodi||"all"),d=_([]),y=_(!1),b=_(!1);_(!1);const m=_({success:[],failed:[]});let S;te([h,g],()=>{clearTimeout(S),S=setTimeout(()=>{N.get("/admin/nim-generation",{search:h.value||void 0,prodi:g.value==="all"?void 0:g.value},{preserveState:!0,replace:!0})},300)});const V=ae(()=>v.registrations.data.length===0?!1:v.registrations.data.every(u=>d.value.includes(u.id))),G=()=>{V.value?d.value=[]:d.value=v.registrations.data.map(u=>u.id)},I=u=>{const a=d.value.indexOf(u);a===-1?d.value.push(u):d.value.splice(a,1)},D=async()=>{if(d.value.length===0){alert("Pilih minimal satu calon mahasiswa");return}y.value=!0;try{const u=await ne.post("/admin/nim-generation/generate",{registration_ids:d.value});m.value=u.data.results,b.value=!0,d.value=[],N.reload({only:["registrations"]})}catch(u){alert(u.response?.data?.message||"Terjadi kesalahan")}finally{y.value=!1}},z=u=>new Date(u).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"});return(u,a)=>(i(),r(p,null,[l(s(se),{title:"Generate NIM"}),l(Z,{breadcrumbs:T},{default:o(()=>[e("div",de,[l(s(U),null,{default:o(()=>[l(s(j),null,{default:o(()=>[e("div",ue,[e("div",null,[l(s(B),{class:"flex items-center gap-2"},{default:o(()=>[l(s(oe),{class:"size-5"}),a[4]||(a[4]=f(" Generate NIM Mahasiswa ",-1))]),_:1}),l(s(F),null,{default:o(()=>[...a[5]||(a[5]=[f(" Generate NIM untuk calon mahasiswa yang sudah menyelesaikan daftar ulang ",-1)])]),_:1})]),l(s(w),{disabled:d.value.length===0||y.value,onClick:D},{default:o(()=>[y.value?(i(),k(s(ie),{key:0,class:"mr-2 size-4 animate-spin"})):(i(),k(s(Y),{key:1,class:"mr-2 size-4"})),f(" Generate NIM ("+n(d.value.length)+") ",1)]),_:1},8,["disabled"])])]),_:1}),l(s(P),null,{default:o(()=>[e("div",me,[e("div",ce,[l(s(re),{class:"absolute top-1/2 left-3 size-4 -translate-y-1/2 text-muted-foreground"}),l(s(Q),{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=t=>h.value=t),placeholder:"Cari nama atau email...",class:"pl-10"},null,8,["modelValue"])]),l(s(q),{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=t=>g.value=t)},{default:o(()=>[l(s(K),{class:"w-full sm:w-64"},{default:o(()=>[l(s(W),{placeholder:"Filter Prodi"})]),_:1}),l(s(X),null,{default:o(()=>[l(s(M),{value:"all"},{default:o(()=>[...a[6]||(a[6]=[f("Semua Prodi",-1)])]),_:1}),(i(!0),r(p,null,x(c.programStudi,t=>(i(),k(s(M),{key:t.id,value:String(t.id)},{default:o(()=>[f(n(t.name)+" ("+n(t.nim_code)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),e("div",fe,[e("table",_e,[e("thead",pe,[e("tr",null,[e("th",ve,[l(s(C),{"model-value":V.value,"onUpdate:modelValue":G},null,8,["model-value"])]),a[7]||(a[7]=e("th",{class:"px-4 py-3 text-left font-medium"}," No. Registrasi ",-1)),a[8]||(a[8]=e("th",{class:"px-4 py-3 text-left font-medium"}," Nama ",-1)),a[9]||(a[9]=e("th",{class:"px-4 py-3 text-left font-medium"}," Program Studi ",-1)),a[10]||(a[10]=e("th",{class:"px-4 py-3 text-left font-medium"}," Jenis Pendaftaran ",-1)),a[11]||(a[11]=e("th",{class:"px-4 py-3 text-left font-medium"}," Tahun Akademik ",-1)),a[12]||(a[12]=e("th",{class:"px-4 py-3 text-left font-medium"}," Tanggal Daftar ",-1))])]),e("tbody",ge,[(i(!0),r(p,null,x(c.registrations.data,t=>(i(),r("tr",{key:t.id,class:le(["hover:bg-muted/50",{"bg-primary/5":d.value.includes(t.id)}])},[e("td",xe,[l(s(C),{"model-value":d.value.includes(t.id),"onUpdate:modelValue":L=>I(t.id)},null,8,["model-value","onUpdate:modelValue"])]),e("td",he,n(t.registration_number),1),e("td",ye,[e("div",null,[e("div",be,n(t.user.name),1),e("div",ke,n(t.user.email),1)])]),e("td",$e,[t.accepted_program_studi?(i(),r("div",we,[e("span",null,n(t.accepted_program_studi.name),1),e("span",Ne,n(t.accepted_program_studi.nim_code),1)])):(i(),r("span",Se,"-"))]),e("td",Ve,n(t.registration_type?.name||"-"),1),e("td",Ce,n(t.registration_period?.academic_year||"-"),1),e("td",Me,n(z(t.created_at)),1)],2))),128)),c.registrations.data.length===0?(i(),r("tr",Te,[...a[13]||(a[13]=[e("td",{colspan:"7",class:"px-4 py-8 text-center text-muted-foreground"}," Tidak ada calon mahasiswa yang siap untuk generate NIM ",-1)])])):$("",!0)])])]),c.registrations.last_page>1?(i(),r("div",Ge,[e("p",Ie," Menampilkan "+n(c.registrations.data.length)+" dari "+n(c.registrations.total)+" data ",1),e("div",De,[(i(!0),r(p,null,x(c.registrations.links,t=>(i(),k(s(w),{key:t.label,size:"sm",variant:t.active?"default":"outline",disabled:!t.url,onClick:L=>t.url&&s(N).get(t.url),innerHTML:t.label},null,8,["variant","disabled","onClick","innerHTML"]))),128))])])):$("",!0)]),_:1})]),_:1})]),l(s(A),{open:b.value,"onUpdate:open":a[3]||(a[3]=t=>b.value=t)},{default:o(()=>[l(s(E),{class:"max-w-lg"},{default:o(()=>[l(s(H),null,{default:o(()=>[l(s(R),null,{default:o(()=>[...a[14]||(a[14]=[f("Hasil Generate NIM",-1)])]),_:1}),l(s(J),null,{default:o(()=>[f(n(m.value.success.length)+" berhasil, "+n(m.value.failed.length)+" gagal ",1)]),_:1})]),_:1}),e("div",ze,[m.value.success.length>0?(i(),r("div",Le,[e("h4",Ue," ✓ Berhasil ("+n(m.value.success.length)+") ",1),e("div",je,[(i(!0),r(p,null,x(m.value.success,t=>(i(),r("div",{key:t.id,class:"flex items-center justify-between rounded bg-green-50 p-2 text-sm dark:bg-green-900/20"},[e("span",null,n(t.name),1),e("span",Be,n(t.nim),1)]))),128))])])):$("",!0),m.value.failed.length>0?(i(),r("div",Pe,[e("h4",Fe," ✗ Gagal ("+n(m.value.failed.length)+") ",1),e("div",Ae,[(i(!0),r(p,null,x(m.value.failed,t=>(i(),r("div",{key:t.id,class:"rounded bg-red-50 p-2 text-sm dark:bg-red-900/20"},[e("div",Ee,n(t.name),1),e("div",He,n(t.reason),1)]))),128))])])):$("",!0)]),l(s(O),null,{default:o(()=>[l(s(w),{onClick:a[2]||(a[2]=t=>b.value=!1)},{default:o(()=>[...a[15]||(a[15]=[f("Tutup",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{xt as default};
